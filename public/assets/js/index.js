function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function t(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,n(e,t)}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var r={__proto__:null,default:function(e,t){return t=t||{},new Promise(function(n,r){var o=new XMLHttpRequest,s=[],i=[],u={},a=function(){return{ok:2==(o.status/100|0),statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:a,headers:{keys:function(){return s},entries:function(){return i},get:function(e){return u[e.toLowerCase()]},has:function(e){return e.toLowerCase()in u}}}};for(var c in o.open(t.method||"get",e,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,t,n){s.push(t=t.toLowerCase()),i.push([t,n]),u[t]=u[t]?u[t]+","+n:n}),n(a())},o.onerror=r,o.withCredentials="include"==t.credentials,t.headers)o.setRequestHeader(c,t.headers[c]);o.send(t.body||null)})}},o=self.fetch||(self.fetch=r.default||r),s=function(){function t(e){this.SDK_HOST_PREFIX="sdk.",this.API_PREFIX="pti.",e&&this.init(e)}var n=t.prototype;return n.init=function(e){this.config=e,e.ptiDomain||(e.ptiDomain=this.resolveDomain())},n.resolveDomain=function(){var e,t=document.currentScript.src;if(t)return this.normalizeHostName(((e=t).indexOf("//")>-1?e.split("/")[2]:e.split("/")[0]).split(":")[0].split("?")[0])},n.normalizeHostName=function(e){var t=e,n=e.indexOf(this.SDK_HOST_PREFIX);return n>-1&&(t=e.substring(n+this.SDK_HOST_PREFIX.length)),t},n.getApiUrl=function(){return"https://"+this.API_PREFIX+this.config.ptiDomain},n.getUserToken=function(t){var n=this,r=this.config.generateTokenPath,s=e({},{method:"POST",body:JSON.stringify(this.config.graphQlBackend?{query:"query getPtiUserToken($request: PtiUserTokenRequest!) {\n            getPtiUserToken(request:$request) {\n              accessToken}\n            }",variables:{request:{clientId:this.config.clientId,payload:t}}}:{"x-pti-client-id":this.config.clientId,"x-pti-token-payload":t})},{headers:{"Content-type":"application/json"}});return o(r,s).then(function(e){if(e.ok)return n.config.graphQlBackend?e.json().then(function(e){return e.data.getPtiUserToken}):e.json();throw new Error(e.statusText)})},t}(),i=function(e){function n(){return e.apply(this,arguments)||this}t(n,e);var r=n.prototype;return r.getFormUrl=function(){return"https://forms."+this.config.ptiDomain+"/"+this.getPathContext()+"?params="},r.renderFrame=function(e,t,n){try{var r=document.createElement("iframe");return r.src=t,r.id=e,r.style.height="100%",r.style.width="100%",r.style.borderWidth="0",n.appendChild(r),Promise.resolve()}catch(e){return Promise.reject(e)}},r.generateForm=function(e){return Promise.resolve()},n}(s),u=function(e){function n(){var t;return(t=e.apply(this,arguments)||this).KYC_PATH_CONTEXT="kyc",t}t(n,e);var r=n.prototype;return r.getPathContext=function(){return this.KYC_PATH_CONTEXT},r.generateForm=function(e){try{var t=this,n=t.getFormUrl(),r={clientId:t.config.clientId,requestId:e.requestId,userId:e.userId,uploadToken:"",kycToken:""},o={method:"POST",url:"/users/"+e.userId+"/assets"};return Promise.resolve(t.getUserToken({method:"POST",url:"/users/"+e.userId+"/kyc"})).then(function(s){return Promise.resolve(t.getUserToken(o)).then(function(o){r.kycToken=s.accessToken,r.uploadToken=o.accessToken;var i=btoa(JSON.stringify(r));t.renderFrame("pti-kyc-form",n+=i,e.parentElement)})})}catch(e){return Promise.reject(e)}},n}(i),a=function(e){function n(){var t;return(t=e.apply(this,arguments)||this).PAYMENT_PATH_CONTEXT="payment",t}t(n,e);var r=n.prototype;return r.getPathContext=function(){return this.PAYMENT_PATH_CONTEXT},r.generateForm=function(e){try{var t=this,n=t.getFormUrl(),r={clientId:t.config.clientId,requestId:e.requestId,userId:e.userId,amount:e.amount,currency:e.currency?e.currency:"USD",statementMessage:e.statementMessage?e.statementMessage:"PTI",token:""};return Promise.resolve(t.getUserToken({method:"POST",url:"/users/"+e.userId+"/transactions/fiat/funding"})).then(function(o){r.token=o.accessToken;var s=btoa(JSON.stringify(r));return Promise.resolve(t.renderFrame("pti-payment-form",n+=s,e.parentElement)).then(function(){})})}catch(e){return Promise.reject(e)}},n}(i),c=new(function(e){function n(){return e.apply(this,arguments)||this}return t(n,e),n.prototype.form=function(e){try{var t;return"KYC"===e.type?t=new u(this.config):"FIAT_FUNDING"===e.type&&(t=new a(this.config)),Promise.resolve(t.generateForm(e)).then(function(){})}catch(e){return Promise.reject(e)}},n}(s));globalThis.PTI=c,globalThis.hasOwnProperty("ptiAsyncInit")&&globalThis.ptiAsyncInit.call();
//# sourceMappingURL=index.js.map
